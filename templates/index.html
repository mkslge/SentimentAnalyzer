<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Emotion Chatbot</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gradient-to-br from-blue-100 to-purple-200 min-h-screen flex items-center justify-center">
    <div class="bg-white w-full max-w-md shadow-xl rounded-2xl p-6 space-y-4">
        <h1 class="text-2xl font-bold text-gray-800 text-center">ðŸ§  Emotion Chatbot</h1>

        <div id="chatlog" class="h-80 overflow-y-auto border rounded-lg p-4 space-y-3 bg-gray-50">
            <!-- Messages will appear here -->
        </div>

        <div class="flex space-x-2">
    <input type="text" id="userInput" placeholder="Type a sentence..."
        class="flex-1 px-4 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-purple-400 outline-none">
    <button onclick="startListening()"
        class="bg-gray-200 text-gray-800 px-4 py-2 rounded-lg hover:bg-gray-300 transition" id="micBtn">
        ðŸŽ¤
    </button>
    <button onclick="sendMessage()"
        class="bg-purple-500 text-white px-4 py-2 rounded-lg hover:bg-purple-600 transition">
        Send
    </button>
</div>
    </div>

    <script>
    async function sendMessage() {
        const input = document.getElementById("userInput");
        const message = input.value.trim();
        if (!message) return;

        const chatlog = document.getElementById("chatlog");

        chatlog.innerHTML += `
            <div class="text-right">
                <div class="inline-block bg-blue-100 text-blue-900 px-4 py-2 rounded-xl">
                    You: ${message}
                </div>
            </div>
        `;
        input.value = "";

        const response = await fetch("/analyze", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ message })
        });

        const data = await response.json();
        chatlog.innerHTML += `
            <div class="text-left">
                <div class="inline-block bg-purple-100 text-purple-900 px-4 py-2 rounded-xl">
                    Bot: ${data.response}
                </div>
            </div>
        `;

        chatlog.scrollTop = chatlog.scrollHeight;
    }

    document.getElementById("userInput").addEventListener("keypress", function (e) {
        if (e.key === "Enter") sendMessage();
    });

    let recognition; // global scope so it's accessible in startListening()

    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;

    if (SpeechRecognition) {
        recognition = new SpeechRecognition();
        recognition.lang = 'en-US';
        recognition.continuous = false;
        recognition.interimResults = false;

        recognition.onresult = (event) => {
            const transcript = event.results[0][0].transcript;
            document.getElementById("userInput").value = transcript;
            sendMessage(); // Auto-send speech input
        };

        recognition.onerror = (event) => {
            alert("Speech recognition error: " + event.error);
        };
    } else {
        const micBtn = document.getElementById("micBtn");
        if (micBtn) {
            micBtn.disabled = true;
            micBtn.innerText = "ðŸŽ¤ Unsupported";
        }
    }

    function startListening() {
        if (recognition) recognition.start();
    }
</script>






</body>
</html>
